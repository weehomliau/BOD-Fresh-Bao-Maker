<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B.O.D åŒ…æ ˆï¼šæé€ŸåŒ…ç‚¹å¸ˆ</title>
    
    <!-- 1. å¼•å…¥ Tailwind CSS (æ ·å¼) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. å¼•å…¥ React å’Œ Babel (è¿è¡Œç¯å¢ƒ) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- è§£å†³æµè§ˆå™¨æ¨¡å—å…¼å®¹æ€§é—®é¢˜ -->
    <script async src="https://ga.jspm.io/npm:es-module-shims@1.7.0/dist/es-module-shims.js"></script>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.292.0"
      }
    }
    </script>
</head>
<body class="bg-neutral-900">
    <div id="root"></div>

    <!-- 3. æ¸¸æˆæ ¸å¿ƒä»£ç  -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { ChefHat, Timer, Trophy, Flame, Utensils, RotateCcw, XCircle, CheckCircle, User, ArrowLeft, Crown, Globe } from 'lucide-react';
        
        // --- Firebase å¯¼å…¥ ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";
        import { getFirestore, collection, addDoc, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

        // --- æ¸¸æˆé…ç½® ---
        const GAME_DURATION = 90; 

        // ==========================================
        // â–¼â–¼â–¼ FIREBASE é…ç½® â–¼â–¼â–¼
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyADgrOOUC0C1fCuFyjeggJCgAPYewz6AEA",
            authDomain: "bod-fresh-bao-maker.firebaseapp.com",
            projectId: "bod-fresh-bao-maker",
            storageBucket: "bod-fresh-bao-maker.firebasestorage.app",
            messagingSenderId: "326015657318",
            appId: "1:326015657318:web:40ad92d97a662e80f8d4a7",
            measurementId: "G-SYYFVWFLYN"
        };
        // ==========================================

        // --- åˆå§‹åŒ–æ•°æ®åº“ ---
        let db = null;
        let isOnline = false;

        if (firebaseConfig.apiKey && firebaseConfig.projectId) {
            try {
                const app = initializeApp(firebaseConfig);
                const analytics = getAnalytics(app); 
                db = getFirestore(app);
                isOnline = true;
                console.log("ğŸ”¥ Firebase è¿æ¥æˆåŠŸï¼šå…¨çƒæ’è¡Œæ¦œå·²æ¿€æ´»");
            } catch (e) {
                console.error("Firebase åˆå§‹åŒ–å¤±è´¥:", e);
            }
        } else {
            console.log("âš ï¸ æœªæ£€æµ‹åˆ° Firebase é…ç½®ï¼Œå°†ä½¿ç”¨æœ¬åœ°ç¦»çº¿æ’è¡Œæ¦œã€‚");
        }

        // --- æ’è¡Œæ¦œé€»è¾‘ ---
        
        const getLeaderboard = async () => {
          if (isOnline && db) {
            try {
                const q = query(collection(db, "leaderboard"), orderBy("score", "desc"), limit(10));
                const querySnapshot = await getDocs(q);
                return querySnapshot.docs.map(doc => doc.data());
            } catch (error) {
                console.error("è¯»å–æ’è¡Œæ¦œå¤±è´¥", error);
                return [];
            }
          } else {
            const saved = localStorage.getItem('bod_leaderboard');
            return saved ? JSON.parse(saved) : [];
          }
        };

        const saveScoreToLeaderboard = async (name, score) => {
          const newEntry = { name, score, date: new Date().toISOString() };
          
          if (isOnline && db) {
            try {
                await addDoc(collection(db, "leaderboard"), newEntry);
                return await getLeaderboard();
            } catch (error) {
                console.error("ä¸Šä¼ æˆç»©å¤±è´¥", error);
                return [];
            }
          } else {
            const current = localStorage.getItem('bod_leaderboard') ? JSON.parse(localStorage.getItem('bod_leaderboard')) : [];
            const updated = [...current, newEntry].sort((a, b) => b.score - a.score).slice(0, 10);
            localStorage.setItem('bod_leaderboard', JSON.stringify(updated));
            return updated;
          }
        };


        // --- B.O.D çœŸå®äº§å“é…æ–¹ (åœ¨æ­¤å¤„æ·»åŠ å›¾ç‰‡é“¾æ¥) ---
        // ä½¿ç”¨æ–¹æ³•ï¼šå°† image: "" æ›¿æ¢ä¸º image: "./images/xxx.jpg"
        const RECIPES = [
          {
            id: 'kungfu_bun',
            name: 'åŠŸå¤«è‚‰åŒ…',
            description: 'B.O.D é•‡åº—ä¹‹å®ï¼Œé…’é¦™æ‰‘é¼»',
            ingredients: ['é¢å›¢', 'çŒªè‚‰ç‰‡', 'åŒ…èœ', 'èŠ±é›•é…’'],
            color: 'bg-orange-100',
            icon: 'ğŸ¥‹',
            image: "", // <--- åœ¨è¿™é‡Œå¡«å…¥å›¾ç‰‡é“¾æ¥
            difficulty: 2
          },
          {
            id: 'bbq_bun',
            name: 'å¾¡å“å‰çƒ§åŒ…',
            description: 'ç‹¬å®¶ç§˜åˆ¶é…±æ±ï¼Œè‚¥ç˜¦é€‚ä¸­',
            ingredients: ['é¢å›¢', 'ç§˜åˆ¶å‰çƒ§'],
            color: 'bg-red-50',
            icon: 'ğŸ–',
            image: "", 
            difficulty: 1
          },
          {
            id: 'lava_bun',
            name: 'å’¸è›‹æµæ²™åŒ…',
            description: 'çˆ†æµ†å£æ„Ÿï¼Œå’¸ç”œäº¤ç»‡',
            ingredients: ['é¢å›¢', 'å’¸è›‹é»„æµæ²™'],
            color: 'bg-yellow-100',
            icon: 'ğŸ¥š',
            image: "", 
            difficulty: 1
          },
          {
            id: 'mei_cai_bun',
            name: 'æ¢…èœåŒ…',
            description: 'ç»å…¸å®¢å®¶é£å‘³ï¼Œå’¸é¦™å¼€èƒƒ',
            ingredients: ['é¢å›¢', 'æ¢…èœ'],
            color: 'bg-green-50',
            icon: 'ğŸ¥¬',
            image: "", 
            difficulty: 1
          },
          {
            id: 'cheese_pot',
            name: 'é¦™é¦™èµ·å¸çª',
            description: 'å¹´è½»äººçš„æœ€çˆ±ï¼Œæ‹‰ä¸èŠå£«',
            ingredients: ['é¢å›¢', 'èŠå£«ç¢', 'åŸ¹æ ¹'],
            color: 'bg-yellow-50',
            icon: 'ğŸ§€',
            image: "", 
            difficulty: 2
          }
        ];

        // --- å¯¹åº”é£Ÿæåº“ (åœ¨æ­¤å¤„æ·»åŠ å›¾ç‰‡é“¾æ¥) ---
        const INGREDIENTS_POOL = [
          { id: 'é¢å›¢', name: 'è€é¢é¢å›¢', icon: 'âšª', image: "" },
          { id: 'ç§˜åˆ¶å‰çƒ§', name: 'ç§˜åˆ¶å‰çƒ§', icon: 'ğŸ–', image: "" },
          { id: 'çŒªè‚‰ç‰‡', name: 'ä¸Šç­‰è‚‰ç‰‡', icon: 'ğŸ¥©', image: "" },
          { id: 'åŒ…èœ', name: 'æ–°é²œåŒ…èœ', icon: 'ğŸ¥¬', image: "" },
          { id: 'èŠ±é›•é…’', name: 'é™ˆå¹´èŠ±é›•', icon: 'ğŸ¶', image: "" }, 
          { id: 'å’¸è›‹é»„æµæ²™', name: 'æµæ²™é¦…', icon: 'ğŸ¥š', image: "" },
          { id: 'æ¢…èœ', name: 'æ¢…èœ', icon: 'ğŸ¥˜', image: "" },
          { id: 'èŠå£«ç¢', name: 'èµ·å¸', icon: 'ğŸ§€', image: "" },
          { id: 'åŸ¹æ ¹', name: 'çƒŸç†åŸ¹æ ¹', icon: 'ğŸ¥“', image: "" },
        ];

        function BODGame() {
          const [gameState, setGameState] = useState('MENU'); 
          const [score, setScore] = useState(0);
          const [timeLeft, setTimeLeft] = useState(GAME_DURATION);
          const [currentOrder, setCurrentOrder] = useState(null);
          const [worktable, setWorktable] = useState([]); 
          const [cookingStep, setCookingStep] = useState('PREP'); 
          const [foldProgress, setFoldProgress] = useState(0); 
          const [steamProgress, setSteamProgress] = useState(0); 
          const [feedback, setFeedback] = useState(null); 
          const [playerName, setPlayerName] = useState('');
          const [isScoreSaved, setIsScoreSaved] = useState(false);
          const [leaderboardData, setLeaderboardData] = useState([]);
          const [isLoadingRank, setIsLoadingRank] = useState(false);

          const timerRef = useRef(null);
          const steamTimerRef = useRef(null);

          useEffect(() => {
            if (gameState === 'PLAYING') {
              timerRef.current = setInterval(() => {
                setTimeLeft((prev) => {
                  if (prev <= 1) {
                    endGame();
                    return 0;
                  }
                  return prev - 1;
                });
              }, 1000);
            }
            return () => clearInterval(timerRef.current);
          }, [gameState]);

          useEffect(() => {
            if (gameState === 'LEADERBOARD') {
                setIsLoadingRank(true);
                getLeaderboard().then(data => {
                    setLeaderboardData(data);
                    setIsLoadingRank(false);
                });
            }
          }, [gameState]);

          const generateNewOrder = () => {
            const randomRecipe = RECIPES[Math.floor(Math.random() * RECIPES.length)];
            setCurrentOrder(randomRecipe);
            setWorktable([]);
            setCookingStep('PREP');
            setFoldProgress(0);
            setSteamProgress(0);
          };

          const startGame = () => {
            setScore(0);
            setTimeLeft(GAME_DURATION);
            generateNewOrder();
            setGameState('PLAYING');
            setFeedback(null);
            setIsScoreSaved(false);
            setPlayerName('');
          };

          const endGame = () => {
            clearInterval(timerRef.current);
            clearInterval(steamTimerRef.current);
            setGameState('GAMEOVER');
          };

          const handleSaveScore = async () => {
            if (!playerName.trim()) {
              showFeedback('âœï¸ è¯·è¾“å…¥åå­—ï¼', 'error');
              return;
            }
            setIsLoadingRank(true);
            await saveScoreToLeaderboard(playerName, score);
            setIsScoreSaved(true);
            showFeedback('ğŸ’¾ æˆç»©å·²ä¿å­˜ï¼', 'success');
            setIsLoadingRank(false);
            setTimeout(() => setGameState('LEADERBOARD'), 1000);
          };

          const handleIngredientClick = (ing) => {
            if (cookingStep !== 'PREP') return;

            if (!currentOrder.ingredients.includes(ing.id)) {
              showFeedback('âŒ é£Ÿæé”™è¯¯ï¼ä¸æ˜¯è¿™ä¸ªé…æ–¹', 'error');
              setWorktable([]);
              return;
            }

            if (worktable.length === 0 && ing.id !== 'é¢å›¢') {
              showFeedback('âš ï¸ è¯·å…ˆæ‹¿é¢å›¢ï¼', 'warning');
              return;
            }

            const newWorktable = [...worktable, ing.id];
            setWorktable(newWorktable);

            const needed = [...currentOrder.ingredients].sort();
            const current = [...newWorktable].sort();
            
            if (JSON.stringify(needed) === JSON.stringify(current)) {
              showFeedback('âœ… é£Ÿæå¤‡é½ï¼å¼€å§‹æè¤¶ï¼', 'success');
              setTimeout(() => setCookingStep('FOLDING'), 500);
            }
          };

          const handleFold = () => {
            if (cookingStep !== 'FOLDING') return;
            const increment = 15; 
            const newProgress = foldProgress + increment;
            
            if (newProgress >= 100) {
              setFoldProgress(100);
              setCookingStep('STEAMING');
              showFeedback('ğŸ¥Ÿ é€ å‹å®Œç¾ï¼æ”¾å…¥è’¸ç¬¼ï¼', 'success');
              startSteaming();
            } else {
              setFoldProgress(newProgress);
            }
          };

          const startSteaming = () => {
            let progress = 0;
            steamTimerRef.current = setInterval(() => {
              progress += 2; 
              setSteamProgress(progress);
              if (progress > 120) { 
                clearInterval(steamTimerRef.current);
                handleSteamResult(false, 'ğŸ”¥ è’¸ç³Šäº†ï¼å¤ªä¹…äº†ï¼');
              }
            }, 50);
          };

          const handleStopSteam = () => {
            clearInterval(steamTimerRef.current);
            if (steamProgress >= 80 && steamProgress <= 100) {
              handleSteamResult(true, 'âœ¨ å®Œç¾å‡ºç‚‰ï¼B.O.D å“è´¨ï¼');
            } else if (steamProgress < 80) {
              handleSteamResult(false, 'â„ï¸ è¿˜æ²¡ç†Ÿï¼é‡Œé¢æ˜¯ç”Ÿçš„ï¼');
            } else {
              handleSteamResult(false, 'ğŸ”¥ è’¸è¿‡å¤´äº†ï¼çš®è€äº†ï¼');
            }
          };

          const handleSteamResult = (success, msg) => {
            if (success) {
              const points = 100 + Math.floor(timeLeft / 10);
              setScore(prev => prev + points);
              showFeedback(msg, 'success');
              setTimeout(generateNewOrder, 1500);
            } else {
              showFeedback(msg, 'error');
              setTimeLeft(prev => Math.max(0, prev - 5));
              setTimeout(() => {
                setWorktable([]);
                setCookingStep('PREP');
                setFoldProgress(0);
                setSteamProgress(0);
              }, 1500);
            }
          };

          const showFeedback = (msg, type) => {
            setFeedback({ msg, type });
            setTimeout(() => setFeedback(null), 1500);
          };

          const getFeedbackColor = () => {
            if (!feedback) return '';
            if (feedback.type === 'error') return 'bg-red-500';
            if (feedback.type === 'success') return 'bg-green-500';
            return 'bg-yellow-500';
          };

          // --- ç•Œé¢æ¸²æŸ“ ---

          if (gameState === 'MENU') {
            return (
              <div className="min-h-screen bg-neutral-900 flex flex-col items-center justify-center p-4 font-sans text-white relative overflow-hidden">
                <div className="absolute top-0 left-0 w-full h-full opacity-10 pointer-events-none">
                     <div className="absolute top-10 left-10 text-9xl">ğŸ¥Ÿ</div>
                     <div className="absolute bottom-20 right-10 text-9xl">â™¨ï¸</div>
                </div>

                <div className="bg-red-700 p-8 rounded-3xl shadow-2xl border-4 border-yellow-500 text-center max-w-md w-full z-10">
                  <div className="mb-6 flex justify-center">
                    <div className="bg-white p-4 rounded-full shadow-lg">
                       <ChefHat size={64} className="text-red-700" />
                    </div>
                  </div>
                  <h1 className="text-4xl font-bold mb-2 text-white">B.O.D åŒ…æ ˆ</h1>
                  <h2 className="text-2xl font-bold mb-6 text-yellow-300">æé€ŸåŒ…ç‚¹å¸ˆ</h2>
                  
                  <div className="flex flex-col gap-3">
                    <button 
                      onClick={startGame}
                      className="w-full bg-yellow-500 hover:bg-yellow-400 text-red-900 font-bold py-4 px-8 rounded-xl text-xl transition-transform hover:scale-105 shadow-lg flex items-center justify-center gap-2"
                    >
                      <Utensils /> å¼€å§‹åˆ¶ä½œ
                    </button>
                    <button 
                      onClick={() => setGameState('LEADERBOARD')}
                      className="w-full bg-red-800 hover:bg-red-900 text-white font-bold py-3 px-8 rounded-xl text-lg transition-transform hover:scale-105 shadow-lg flex items-center justify-center gap-2 border border-red-600"
                    >
                      <Trophy size={20} /> æŸ¥çœ‹æ’è¡Œæ¦œ
                    </button>
                  </div>
                </div>
                <div className="mt-8 text-gray-500 text-sm">Made for B.O.D Games</div>
              </div>
            );
          }

          if (gameState === 'LEADERBOARD') {
            return (
              <div className="min-h-screen bg-neutral-900 flex flex-col items-center p-4 text-white overflow-y-auto">
                 <div className="w-full max-w-md mt-8">
                   <div className="flex items-center justify-between mb-6">
                      <button onClick={() => setGameState('MENU')} className="bg-neutral-800 p-2 rounded-full hover:bg-neutral-700"><ArrowLeft /></button>
                      <h2 className="text-2xl font-bold text-yellow-400 flex items-center gap-2"><Trophy className="text-yellow-400" /> åŒ…ç‚¹å¤§å¸ˆæ¦œ</h2>
                      <div className="w-10"></div>
                   </div>
                   
                   <div className="text-center mb-4 text-xs text-gray-400">
                     {isOnline ? <span className="text-green-400 flex items-center justify-center gap-1"><Globe size={12}/> å…¨çƒè”ç½‘æ¨¡å¼</span> : <span className="text-gray-500">ç¦»çº¿æ¨¡å¼ (å¡«å…¥ Key å¼€å¯è”ç½‘)</span>}
                   </div>

                   <div className="bg-white text-neutral-900 rounded-2xl shadow-xl overflow-hidden min-h-[300px]">
                      <div className="bg-red-600 p-4 text-white font-bold grid grid-cols-12 text-sm text-center">
                        <div className="col-span-2">æ’å</div>
                        <div className="col-span-6 text-left pl-4">åŒ…ç‚¹å¸ˆ</div>
                        <div className="col-span-4">åˆ†æ•°</div>
                      </div>
                      
                      {isLoadingRank ? (
                          <div className="p-8 text-center text-gray-500 flex flex-col items-center">
                            <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-red-600 mb-2"></div>
                            è¯»å–ä¸­...
                          </div>
                      ) : leaderboardData.length === 0 ? (
                        <div className="p-8 text-center text-gray-400">
                          æš‚æ— è®°å½•ï¼Œå¿«å»æŒ‘æˆ˜å§ï¼
                        </div>
                      ) : (
                        <div>
                          {leaderboardData.map((entry, index) => (
                            <div key={index} className={`grid grid-cols-12 items-center p-4 border-b text-center ${index < 3 ? 'bg-yellow-50' : ''}`}>
                              <div className="col-span-2 font-bold flex justify-center">
                                {index === 0 && <Crown size={20} className="text-yellow-500" fill="currentColor" />}
                                {index === 1 && <Crown size={20} className="text-gray-400" fill="currentColor" />}
                                {index === 2 && <Crown size={20} className="text-orange-400" fill="currentColor" />}
                                {index > 2 && <span className="text-gray-500 text-sm">#{index + 1}</span>}
                              </div>
                              <div className="col-span-6 text-left pl-4 font-bold text-gray-800 truncate">
                                {entry.name}
                              </div>
                              <div className="col-span-4 font-mono font-bold text-red-600 text-lg">
                                {entry.score}
                              </div>
                            </div>
                          ))}
                        </div>
                      )}
                   </div>
                 </div>
              </div>
            );
          }

          if (gameState === 'GAMEOVER') {
            return (
              <div className="min-h-screen bg-neutral-900 flex flex-col items-center justify-center p-4 text-white">
                <div className="bg-white text-neutral-900 p-8 rounded-3xl shadow-2xl max-w-md w-full text-center border-t-8 border-red-600">
                  <Trophy size={64} className="mx-auto text-yellow-500 mb-4" />
                  <h2 className="text-3xl font-bold mb-2">è¥ä¸šç»“æŸ</h2>
                  <p className="text-gray-600 mb-6">æœ¬æ¬¡å¾—åˆ†</p>
                  
                  <div className="text-6xl font-black text-red-600 mb-8 font-mono">
                    {score}
                  </div>

                  {!isScoreSaved ? (
                    <div className="mb-8">
                       <p className="text-sm text-gray-500 mb-2">è¾“å…¥åå­—ä¿å­˜åˆ°æ’è¡Œæ¦œ</p>
                       <div className="flex gap-2">
                         <div className="relative flex-1">
                           <User className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" size={18} />
                           <input 
                              type="text" 
                              value={playerName}
                              onChange={(e) => setPlayerName(e.target.value)}
                              placeholder="æ‚¨çš„åå­—"
                              className="w-full pl-10 pr-4 py-2 border-2 border-gray-200 rounded-xl focus:border-red-500 outline-none font-bold"
                              maxLength={10}
                           />
                         </div>
                         <button 
                            onClick={handleSaveScore}
                            disabled={isLoadingRank}
                            className={`bg-red-600 hover:bg-red-500 text-white font-bold py-2 px-4 rounded-xl flex items-center ${isLoadingRank ? 'opacity-50 cursor-not-allowed' : ''}`}
                         >
                            {isLoadingRank ? '...' : 'ä¿å­˜'}
                         </button>
                       </div>
                    </div>
                  ) : (
                    <div className="mb-8 p-3 bg-green-100 text-green-700 rounded-xl font-bold flex items-center justify-center gap-2">
                      <CheckCircle size={20} /> æˆç»©å·²ä¸Šä¼ 
                    </div>
                  )}

                  <div className="grid grid-cols-2 gap-3">
                    <button 
                      onClick={() => setGameState('LEADERBOARD')}
                      className="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 px-4 rounded-xl flex items-center justify-center gap-2 transition-colors"
                    >
                      <Trophy size={18}/> æ’è¡Œæ¦œ
                    </button>
                    <button 
                      onClick={startGame}
                      className="bg-yellow-500 hover:bg-yellow-400 text-red-900 font-bold py-3 px-4 rounded-xl flex items-center justify-center gap-2 transition-colors"
                    >
                      <RotateCcw size={18}/> å†ç©ä¸€æ¬¡
                    </button>
                  </div>
                  
                  <button 
                    onClick={() => setGameState('MENU')}
                    className="w-full mt-3 text-gray-400 hover:text-gray-600 text-sm font-medium py-2"
                  >
                    è¿”å›ä¸»èœå•
                  </button>
                </div>
              </div>
            );
          }

          if (!currentOrder && gameState === 'PLAYING') {
              return <div className="min-h-screen flex items-center justify-center bg-gray-100">å‡†å¤‡ä¸­...</div>;
          }

          return (
            <div className="min-h-screen bg-gray-100 flex flex-col font-sans max-w-md mx-auto shadow-2xl overflow-hidden relative">
              <div className="bg-red-700 text-white p-3 flex justify-between items-center shadow-md z-10">
                <div className="flex items-center gap-2 font-bold text-xl">
                  <div className="bg-red-800 p-1.5 rounded-lg"><Timer size={20}/></div>
                  <span className={`${timeLeft < 10 ? 'text-yellow-300 animate-pulse' : ''}`}>{timeLeft}s</span>
                </div>
                <div className="font-black text-2xl text-yellow-400">
                   {score} åˆ†
                </div>
              </div>

              <div className="bg-white p-4 border-b border-gray-200">
                <div className="flex items-start gap-4">
                  {/* --- è®¢å•å›¾ç‰‡æ˜¾ç¤ºé€»è¾‘ --- */}
                  <div className="w-20 h-20 bg-orange-100 rounded-lg flex items-center justify-center text-4xl shadow-inner border border-orange-200 overflow-hidden">
                    {currentOrder.image ? (
                        <img src={currentOrder.image} alt={currentOrder.name} className="w-full h-full object-cover" />
                    ) : (
                        currentOrder.icon
                    )}
                  </div>
                  <div className="flex-1">
                    <div className="flex justify-between items-center mb-1">
                        <span className="text-xs font-bold text-red-600 uppercase tracking-wider">å½“å‰è®¢å• New Order</span>
                    </div>
                    <h3 className="text-xl font-bold text-gray-800 mb-1">{currentOrder.name}</h3>
                    <p className="text-xs text-gray-500 mb-2">{currentOrder.description}</p>
                    <div className="flex flex-wrap gap-1">
                      {currentOrder.ingredients.map((ing, idx) => (
                        <span key={idx} className={`text-xs px-2 py-0.5 rounded-full border ${worktable.includes(ing) ? 'bg-green-100 text-green-700 border-green-200' : 'bg-gray-100 text-gray-500 border-gray-200'}`}>
                          {ing}
                        </span>
                      ))}
                    </div>
                  </div>
                </div>
              </div>

              <div className="flex-1 bg-neutral-100 relative overflow-hidden flex flex-col">
                
                {feedback && (
                  <div className={`absolute top-4 left-1/2 transform -translate-x-1/2 z-50 px-6 py-3 rounded-full shadow-lg text-white font-bold flex items-center gap-2 animate-bounce ${getFeedbackColor()}`}>
                    {feedback.type === 'success' ? <CheckCircle size={20}/> : <XCircle size={20}/>}
                    {feedback.msg}
                  </div>
                )}

                <div className="flex-1 flex flex-col items-center justify-center p-6 transition-all">
                  
                  {cookingStep === 'PREP' && (
                    <div className="relative w-64 h-64 bg-white rounded-full border-4 border-gray-200 shadow-xl flex items-center justify-center">
                      {worktable.length === 0 && <span className="text-gray-300 font-bold">ç‚¹å‡»ä¸‹æ–¹é£Ÿæ<br/>å¼€å§‹åˆ¶ä½œ</span>}
                      {/* --- å·¥ä½œå°é£Ÿææ˜¾ç¤ºé€»è¾‘ --- */}
                      {worktable.includes('é¢å›¢') && <div className="absolute w-56 h-56 bg-orange-50 rounded-full border border-orange-100 shadow-inner"></div>}
                      {worktable.slice(1).map((ing, i) => {
                          const ingredient = INGREDIENTS_POOL.find(p => p.id === ing);
                          return (
                            <div key={i} className="absolute text-4xl animate-in zoom-in duration-300 flex items-center justify-center" style={{ transform: `translate(${Math.random()*20-10}px, ${Math.random()*20-10}px)` }}>
                              {ingredient?.image ? (
                                  <img src={ingredient.image} className="w-12 h-12 object-contain drop-shadow-md" />
                              ) : (
                                  ingredient?.icon
                              )}
                            </div>
                          );
                      })}
                    </div>
                  )}

                  {cookingStep === 'FOLDING' && (
                    <div className="flex flex-col items-center w-full">
                       <div 
                         className="w-56 h-56 bg-orange-100 rounded-full border-4 border-orange-200 shadow-xl flex items-center justify-center cursor-pointer active:scale-95 transition-transform relative overflow-hidden"
                         onClick={handleFold}
                       >
                         {/* æ˜¾ç¤ºå½“å‰æ­£åœ¨åˆ¶ä½œçš„åŒ…å­çš„å›¾ç‰‡(å¦‚æœæœ‰)æˆ–é»˜è®¤å›¾æ ‡ */}
                         {currentOrder.image ? (
                             <img src={currentOrder.image} className="w-full h-full object-cover" />
                         ) : (
                             <div className="text-6xl animate-pulse">ğŸ¥Ÿ</div>
                         )}
                         <div className="absolute inset-0 bg-black opacity-10" style={{ clipPath: `polygon(50% 50%, ${100-foldProgress}% 0, 100% 0, 100% 100%, 0 100%, 0 0)` }}></div>
                       </div>
                       <p className="mt-6 text-gray-500 font-bold animate-pulse">ç–¯ç‹‚ç‚¹å‡»åŒ…å­è¿›è¡Œæè¤¶ï¼</p>
                       <div className="w-64 h-4 bg-gray-200 rounded-full mt-2 overflow-hidden">
                         <div className="h-full bg-yellow-500 transition-all duration-100" style={{ width: `${foldProgress}%` }}></div>
                       </div>
                    </div>
                  )}

                  {cookingStep === 'STEAMING' && (
                    <div className="flex flex-col items-center w-full">
                       <div className="w-64 h-64 bg-gray-200 rounded-3xl relative overflow-hidden border-b-8 border-gray-300 flex items-center justify-center">
                          <Flame className={`absolute text-orange-500 opacity-20 w-full h-full animate-pulse`} />
                          <div className="z-10 text-8xl">â™¨ï¸</div>
                          
                          <div className="absolute bottom-0 left-0 w-2 h-full bg-gray-300">
                            <div className="absolute bottom-0 left-0 w-full bg-gradient-to-t from-blue-400 to-red-500 transition-all duration-75" style={{ height: `${steamProgress}%` }}></div>
                          </div>
                          
                          <div className="absolute bottom-[80%] left-0 w-full h-0.5 bg-green-500 z-20"></div>
                          <div className="absolute bottom-[100%] left-0 w-full h-0.5 bg-red-500 z-20"></div>
                       </div>
                       
                       <button 
                         onMouseDown={handleStopSteam}
                         onTouchStart={handleStopSteam}
                         className="mt-6 bg-red-600 text-white font-bold py-4 px-12 rounded-full text-xl shadow-lg active:bg-red-700 active:scale-95 transition-all"
                       >
                         ç«‹å³å‡ºç‚‰!
                       </button>
                       <p className="mt-2 text-xs text-gray-500">å½“æŒ‡ç¤ºæ¡åˆ°è¾¾ç»¿è‰²åŒºåŸŸæ—¶ç‚¹å‡»</p>
                    </div>
                  )}

                </div>

                {cookingStep === 'PREP' && (
                  <div className="bg-white p-4 pb-8 rounded-t-3xl shadow-[0_-5px_20px_rgba(0,0,0,0.1)] z-10">
                    <h4 className="text-xs font-bold text-gray-400 mb-3 uppercase text-center">é£Ÿæé€‰æ‹© Ingredients</h4>
                    <div className="grid grid-cols-4 gap-3">
                      {INGREDIENTS_POOL.map((ing) => (
                        <button
                          key={ing.id}
                          onClick={() => handleIngredientClick(ing)}
                          className="flex flex-col items-center justify-center p-2 rounded-xl bg-gray-50 hover:bg-gray-100 border border-gray-100 active:scale-90 transition-all aspect-square overflow-hidden"
                        >
                          {/* --- æŒ‰é’®å›¾ç‰‡æ˜¾ç¤ºé€»è¾‘ --- */}
                          <div className="w-10 h-10 flex items-center justify-center mb-1">
                              {ing.image ? (
                                  <img src={ing.image} alt={ing.name} className="w-full h-full object-contain" />
                              ) : (
                                  <span className="text-2xl">{ing.icon}</span>
                              )}
                          </div>
                          <span className="text-[10px] font-medium text-gray-600 leading-tight text-center">{ing.name}</span>
                        </button>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            </div>
          );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<BODGame />);
    </script>
</body>
</html>
